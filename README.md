# events-backend

# Требования
- Наличие docker
- python 3.10+
- Получить .env файл. Запросить у тг @akryuk

# Запуск
В Makefile содержится набор команд по управлению проектом (обновляется)
Порядок запуска:
- make build - создаст image билда, который будет использоваться в docker-compose
- make up - запуск всех контейнеров
- poetry shell
- pre-commit install - установка линтера ruff перед запуском git commit ...
- make down - удаляет все контейнеры (данные остаются)

## Работа с зависимостями
```
$ poetry add <lib_name>  # добавляем в poetry новую зависимость
$ make build  # ребилд образа
$ make up  # запуск контейнеров
```
## Миграции
Создать миграцию
```$ alembic revision -m 'название миграции' --autogenerate ```

Обновиться до последней версии
```$ alembic upgrade head```

Откатиться на n миграций назад (вместо n - 1,2,3 итд)
```$ alembic downgrade -n```

## Lint + Format
В проекте используется ruff, настройки хранятся в файле ```ruff.toml```
Запустить можно в проекте
```
$ poetry shell
$ ruff check . - проверяет все файлы в проекте
$ ruff check --fix . - исправляет в соответствии с настройками
$ ruff format . - форматирует весь код в проекте
$ ruff format . --check - показывает ошибки и какие файлы будут отформатированы
```
Также ruff подключен к pre-commit, перед каждым коммитом будет запускаться linter + formatter
если есть ошибки, но необходимо срочно сделать коммит, можно сделать ```git commit -m 'fixes' --no-verify```

## Авторизация
Авторизация реализуется на фронте, страница ```/login``` отправляет запрос на сайт itstrana.site и получает
authorization_token и refresh_token, сохраняет их в localStorage и вместе с каждым запросом отправляет на бэкенд.
На бэке токен проверяется на валидность через itstrana.site и в случае окончания токена отдает 401 или 403.
В openapi документации по адресу api/docs/ есть интерактивная дока, с помощью которой можно протестировать API
эндпоинты. Чтобы не заморачиваться с ключами можно авторизоваться под псевдо-клиентом, нажав на иконку замка и введя в
value - 'mock'.
В таком случае на бэк будет отправляться authorization_token = Bearer mock и авторизация будет пропускаться.
Все запросы будут идти от аккаунта со статусом "director"
